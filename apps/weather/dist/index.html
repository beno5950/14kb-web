<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>14KB Weather - Ultra-lightweight Weather App</title>
    <meta
      name="description"
      content="Get detailed weather reports in under 14KB"
    />
    <link rel="stylesheet" href="src/styles.css" />
  </head>
  <body>
    <header>
      <h1>14KB Weather</h1>
      <button id="theme-toggle" aria-label="Toggle dark mode">Dark</button>
    </header>

    <main>
      <section class="search">
        <form id="weather-form">
          <label for="zipcode">Enter ZIP Code</label>
          <div class="input-group">
            <input
              type="text"
              id="zipcode"
              name="zipcode"
              placeholder="12345"
              pattern="[0-9]{5}"
              maxlength="5"
              required
              autocomplete="postal-code"
            />
            <button type="submit">Get Weather</button>
          </div>
        </form>
      </section>

      <section
        id="weather-display"
        class="weather-display"
        style="display: none"
      >
        <div class="weather-card">
          <div class="weather-header">
            <h2 id="location-name"></h2>
            <div class="weather-icon">
              <span id="weather-emoji" role="img"></span>
            </div>
          </div>

          <div class="weather-main">
            <div class="temperature">
              <span id="temp-current"></span>
              <div class="temp-range">
                <span id="temp-high"></span> / <span id="temp-low"></span>
              </div>
            </div>

            <div class="weather-details">
              <p id="weather-description"></p>
              <p>Feels like <span id="feels-like"></span></p>
            </div>
          </div>

          <div class="weather-stats">
            <div class="stat">
              <span class="stat-label">Humidity</span>
              <span class="stat-value" id="humidity"></span>
            </div>
            <div class="stat">
              <span class="stat-label">Wind</span>
              <span class="stat-value" id="wind"></span>
            </div>
            <div class="stat">
              <span class="stat-label">Pressure</span>
              <span class="stat-value" id="pressure"></span>
            </div>
            <div class="stat">
              <span class="stat-label">Visibility</span>
              <span class="stat-value" id="visibility"></span>
            </div>
          </div>

          <div class="weather-sun">
            <div class="sun-time">
              <span>Sunrise</span>
              <span id="sunrise"></span>
            </div>
            <div class="sun-time">
              <span>Sunset</span>
              <span id="sunset"></span>
            </div>
          </div>
        </div>
      </section>

      <section id="error-display" class="error-display" style="display: none">
        <div class="error-card">
          <h3>Warning: Weather Unavailable</h3>
          <p id="error-message"></p>
          <button id="retry-button">Try Again</button>
        </div>
      </section>

      <section id="loading" class="loading" style="display: none">
        <div class="loading-spinner">
          <div class="spinner"></div>
          <p>Fetching weather data...</p>
        </div>
      </section>
    </main>

    <footer>
      <p>
        Weather data provided by
        <a href="https://openweathermap.org" target="_blank" rel="noopener"
          >OpenWeatherMap</a
        >
      </p>
      <p>
        &copy; 2024 14KB Weather. Built with vanilla HTML, CSS, and JavaScript.
      </p>
    </footer>

    <script type="module">var o=class{constructor(){this.elements={form:document.getElementById("weather-form"),zipInput:document.getElementById("zipcode"),weatherDisplay:document.getElementById("weather-display"),errorDisplay:document.getElementById("error-display"),loading:document.getElementById("loading"),themeToggle:document.getElementById("theme-toggle"),retryButton:document.getElementById("retry-button")},this.weatherElements={locationName:document.getElementById("location-name"),weatherEmoji:document.getElementById("weather-emoji"),tempCurrent:document.getElementById("temp-current"),tempHigh:document.getElementById("temp-high"),tempLow:document.getElementById("temp-low"),description:document.getElementById("weather-description"),feelsLike:document.getElementById("feels-like"),humidity:document.getElementById("humidity"),wind:document.getElementById("wind"),pressure:document.getElementById("pressure"),visibility:document.getElementById("visibility"),sunrise:document.getElementById("sunrise"),sunset:document.getElementById("sunset")},this.init()}init(){this.bindEvents(),this.initTheme(),this.loadFromStorage()}bindEvents(){this.elements.form.addEventListener("submit",this.handleSubmit.bind(this)),this.elements.themeToggle.addEventListener("click",this.toggleTheme.bind(this)),this.elements.retryButton.addEventListener("click",this.handleRetry.bind(this)),this.elements.zipInput.addEventListener("input",e=>{e.target.value=e.target.value.replace(/\D/g,"").slice(0,5)})}async handleSubmit(e){e.preventDefault();let t=this.elements.zipInput.value.trim();if(!/^\d{5}$/.test(t)){this.showError("Please enter a valid 5-digit ZIP code");return}await this.fetchWeather(t)}async handleRetry(){let e=this.elements.zipInput.value.trim();e&&await this.fetchWeather(e)}async fetchWeather(e){this.showLoading();try{let t=new AbortController,n=setTimeout(()=>t.abort(),15e3),i=await fetch(`/api/weather?zip=${e}`,{signal:t.signal});clearTimeout(n);let s=await i.json();if(!i.ok)throw new Error(s.message||"Failed to fetch weather data");this.displayWeather(s),this.saveToStorage(e,s)}catch(t){t.name==="AbortError"?this.showError("Request timed out. Please check your connection and try again."):this.showError(t.message)}}displayWeather(e){let{name:t,main:{temp:n,feels_like:i,temp_min:s,temp_max:r,humidity:a,pressure:h},weather:[{description:m,icon:d}],wind:{speed:l,deg:c=0},visibility:u,sys:{sunrise:g,sunset:y}}=e;this.weatherElements.locationName.textContent=t,this.weatherElements.weatherEmoji.textContent=this.getWeatherIcon(d),this.weatherElements.tempCurrent.textContent=`${Math.round(n)}\xB0F`,this.weatherElements.tempHigh.textContent=`${Math.round(r)}\xB0F`,this.weatherElements.tempLow.textContent=`${Math.round(s)}\xB0F`,this.weatherElements.description.textContent=m,this.weatherElements.feelsLike.textContent=`${Math.round(i)}\xB0F`,this.weatherElements.humidity.textContent=`${a}%`,this.weatherElements.wind.textContent=`${Math.round(l)} mph ${this.getWindDirection(c)}`,this.weatherElements.pressure.textContent=`${Math.round(h*.02953)} inHg`,this.weatherElements.visibility.textContent=`${Math.round(u*621371e-9)} mi`,this.weatherElements.sunrise.textContent=this.formatTime(g),this.weatherElements.sunset.textContent=this.formatTime(y),this.showWeather()}getWeatherIcon(e){return{"01d":"Clear","01n":"Clear Night","02d":"Partly Cloudy","02n":"Cloudy Night","03d":"Cloudy","03n":"Cloudy","04d":"Overcast","04n":"Overcast","09d":"Rain","09n":"Rain","10d":"Light Rain","10n":"Rain","11d":"Thunderstorm","11n":"Thunderstorm","13d":"Snow","13n":"Snow","50d":"Fog","50n":"Fog"}[e]||"Partly Cloudy"}getWindDirection(e){return["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"][Math.round(e/22.5)%16]}formatTime(e){return new Date(e*1e3).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}showLoading(){this.hideAllSections(),this.elements.loading.style.display="block"}showWeather(){this.hideAllSections(),this.elements.weatherDisplay.style.display="block"}showError(e){this.hideAllSections(),document.getElementById("error-message").textContent=e,this.elements.errorDisplay.style.display="block"}hideAllSections(){this.elements.weatherDisplay.style.display="none",this.elements.errorDisplay.style.display="none",this.elements.loading.style.display="none"}initTheme(){let e=localStorage.getItem("weather-theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;e?document.documentElement.setAttribute("data-theme",e):t&&document.documentElement.setAttribute("data-theme","dark"),this.updateThemeToggle()}toggleTheme(){let t=document.documentElement.getAttribute("data-theme")==="dark"?"light":"dark";document.documentElement.setAttribute("data-theme",t),localStorage.setItem("weather-theme",t),this.updateThemeToggle()}updateThemeToggle(){let e=document.documentElement.getAttribute("data-theme")==="dark";this.elements.themeToggle.textContent=e?"Light":"Dark",this.elements.themeToggle.setAttribute("aria-label",e?"Switch to light mode":"Switch to dark mode")}saveToStorage(e,t){let n={zipcode:e,data:t,timestamp:Date.now()};localStorage.setItem("weather-cache",JSON.stringify(n))}loadFromStorage(){try{let e=localStorage.getItem("weather-cache");if(!e)return;let{zipcode:t,data:n,timestamp:i}=JSON.parse(e);Date.now()-i<600*1e3&&(this.elements.zipInput.value=t,this.displayWeather(n))}catch{}}};document.addEventListener("DOMContentLoaded",()=>{new o});
</script>
  </body>
</html>
